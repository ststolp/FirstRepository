  <!DOCTYPE html>
         <!-- This is assignment 11 -->
  <html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="assign04.css">
    <title>Mileage Calculator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      button {
          background-color: rgb(62, 106, 247);
          color: white;
           border: 2px solid #4CAF50; 
       }
   </style>
  </head>
 <body>
  <div class="sidemargin">
 </div>

<!-- This div tag will be used to insert the HTML string generated by the AJAX request using the JSON string generated by the assign09.php file 
  <div class="sidemargin" id="slist">
  </div> -->
 <script>

// onclick button to reset the html page to display the calculator
   function calculator() {
       var form = "<h1>Mileage Calculator</h1><h2>Starting point</h2><label>City</label>"+
"<input type='text' name='startCity' value=''>\n<label>State</label>\n<input type='text' name='startState' value='' maxlength='2'><h2>Destination</h2>\n"+
"<label>City</label>\n<input type='text' name='endCity' value=''>\n<label>State</label><input type='text' name='endState' value='' maxlength='2'>" +
"<button type='button' onclick='handleRequest()'>Calculate</button>\n<button type='reset'>Clear</button>";
       document.getElementById("slist").innerHTML = form;
   }
var httpRequest;
 function handleRequest()  {


    var inputs = document.getElementsByTagName("input");
        
//split key value pairs with &
   if (inputs[0].name == "" || inputs[0].value == "" )
        return;
  var string = "?" + inputs[0].name + "=" + inputs[0].value;
   for(i=1; i < inputs.length ; i++) {
           if (inputs[i].name == "" || inputs[i].value == "")
                return;
    string = string + "&" + inputs[i].name + "=" + inputs[i].value;
  }
   // validate the user input  -- only check if they're filled
         
    
     httpRequest = new XMLHttpRequest;
     
      httpRequest.onreadystatechange = function() {
     
         if(httpRequest.readyState == 4 && httpRequest.status == 200) {
   
            var text = httpRequest.responseText;
   
          var obj = JSON.parse(text);
          var trip = obj.trip;

// TODO display the array of tmode ....
     //Create an html table using a list. Insert the parsed JSON object with the respective data for each column and cell.
     //The string is inserted into the content of the div tag when the id is slist.
                   var list = "<table border='3'><tr><th>Start</th><th>Destination</th><th>Miles</th><th>Travel Modes</th></tr>";

                  list = list + "<tr><td>" + trip.startcity + ", " + trip.startstate + "</td><td>" + trip.endcity + ", " + trip.endstate + 
                    "</td><td>" + trip.miles + "</td><td>"; 
                   if (trip.tmode != null) {
                        list = list + trip.tmode + "</td></tr>";
                  } else {
                     list = list + "</td></tr>";
                   }
                 list = list + "\n<button type='button' onclick='calculator()'>Back To Calculator</button>";
                  document.getElementById("slist").innerHTML = list;
            }
     };
         //open or initialize the file to be processed in GET mode and asynchronous (by passing true)

   //the query string must be appended to the end of this url
          httpRequest.open("GET", "/cgi-bin/ercanbracks/mileage/mileageAjaxJSON" + string, true);
      // send the request
                   httpRequest.send();
      }
  </script>
   
    <div class="sidemargin box" id="slist">     
       <h1>Mileage Calculator</h1>
        <h2>Starting point</h2>
        <label>City</label>
        <input type="text" name="startCity" value="">
        <label>State</label>
        <input type="text" name="startState" value="" maxlength="2">
        <h2>Destination</h2>
        <label>City</label>
        <input type="text" name="endCity" value="">
        <label>State</label>
        <input type="text" name="endState" value="" maxlength="2">
          <button type="button" onclick="handleRequest()">Calculate</button>
          <button type="reset">Clear</button>
     </div>

</body>

</html>
